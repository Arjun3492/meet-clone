(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[435],{1040:function(e,o,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/meeting/[roomId]",function(){return n(3495)}])},3495:function(e,o,n){"use strict";n.r(o),n.d(o,{default:function(){return _roomId_}});var t=n(2676),l=n(5271),i=n(2222),r=n.n(i),a=n(4434),s=n(3087);let{useState:c,useEffect:u,useRef:d}=n(5271);var hooks_usePeer=()=>{let e=(0,a.s)(),o=(0,s.useRouter)().query.roomId,[t,l]=c(null),[i,r]=c(""),g=d(!1);return u(()=>{let t;!g.current&&o&&e&&(g.current=!0,async function(){l(t=new(await n.e(229).then(n.bind(n,5229))).default),t.on("open",n=>{console.log("your peer id is ".concat(n)),r(n),null==e||e.emit("join-room",o,n)})}())},[o,e]),{peer:t,myId:i}},hooks_useMediaStream=()=>{let[e,o]=(0,l.useState)(null),n=(0,l.useRef)(!1);return(0,l.useEffect)(()=>{n.current||(n.current=!0,async function(){try{let e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});console.log("setting your stream"),o(e)}catch(e){console.log("Error in media navigator",e)}}())},[]),{stream:e}},hooks_usePlayer=(e,o,n)=>{let t=(0,a.s)(),[i,c]=(0,l.useState)({}),u=(0,s.useRouter)(),d=r()(i),g=d[e];return delete d[e],{players:i,setPlayers:c,playerHighlighted:g,nonHighlightedPlayers:d,toggleAudio:()=>{console.log("I toggled my audio"),c(o=>{let n=r()(o);return n[e].muted=!n[e].muted,{...n}}),t.emit("user-toggle-audio",e,o)},toggleVideo:()=>{console.log("I toggled my video"),c(o=>{let n=r()(o);return n[e].playing=!n[e].playing,{...n}}),t.emit("user-toggle-video",e,o)},leaveRoom:()=>{t.emit("user-leave",e,o),console.log("leaving room",o),null==n||n.disconnect(),u.push("/")}}},g=n(5110),m=n.n(g),_=n(2187),y=n.n(_),v=n(2189),h=n(1959),f=n(311),p=n(5560),P=n.n(p),component_Player=e=>{let{url:o,muted:n,playing:l,isActive:i}=e;return(0,t.jsxs)("div",{className:y()(P().playerContainer,{[P().notActive]:!i,[P().active]:i,[P().notPlaying]:!l}),children:[l?(0,t.jsx)(m(),{url:o,muted:n,playing:l,width:"100%",height:"100%"}):(0,t.jsx)(v.Z,{className:P().user,size:i?400:150}),i?void 0:n?(0,t.jsx)(h.Z,{className:P().icon,size:20}):(0,t.jsx)(f.Z,{className:P().icon,size:20})]})},x=n(462),C=n(1020),j=n(6440),N=n(7466),k=n.n(N),component_Bottom=e=>{let{muted:o,playing:n,toggleAudio:l,toggleVideo:i,leaveRoom:r}=e;return(0,t.jsxs)("div",{className:k().bottomMenu,children:[o?(0,t.jsx)(h.Z,{className:y()(k().icon,k().active),size:55,onClick:l}):(0,t.jsx)(f.Z,{className:k().icon,size:55,onClick:l}),n?(0,t.jsx)(x.Z,{className:k().icon,size:55,onClick:i}):(0,t.jsx)(C.Z,{className:y()(k().icon,k().active),size:55,onClick:i}),(0,t.jsx)(j.Z,{size:55,className:y()(k().icon),onClick:r})]})},w=n(3136),A=n.n(w),_roomId_=()=>{let e=(0,a.s)(),{roomId:o}=(0,s.useRouter)().query,{peer:n,myId:i}=hooks_usePeer(),{stream:c}=hooks_useMediaStream(),{players:u,setPlayers:d,playerHighlighted:g,nonHighlightedPlayers:m,toggleAudio:_,toggleVideo:y,leaveRoom:v}=hooks_usePlayer(i,o,n),[h,f]=(0,l.useState)([]);return(0,l.useEffect)(()=>{if(!e||!n||!c)return;let handleUserConnected=e=>{console.log("user connected in room with userId ".concat(e));let o=n.call(e,c);o.on("stream",n=>{console.log("incoming stream from ".concat(e)),d(o=>({...o,[e]:{url:n,muted:!0,playing:!0}})),f(n=>({...n,[e]:o}))})};return e.on("user-connected",handleUserConnected),()=>{e.off("user-connected",handleUserConnected)}},[n,d,e,c]),(0,l.useEffect)(()=>{if(!e)return;let handleToggleAudio=e=>{console.log("user with id ".concat(e," toggled audio")),d(o=>{let n=r()(o);return n[e].muted=!n[e].muted,{...n}})},handleToggleVideo=e=>{console.log("user with id ".concat(e," toggled video")),d(o=>{let n=r()(o);return n[e].playing=!n[e].playing,{...n}})},handleUserLeave=e=>{var o;console.log("user ".concat(e," is leaving the room")),null===(o=h[e])||void 0===o||o.close();let n=r()(u);delete n[e],d(n)};return e.on("user-toggle-audio",handleToggleAudio),e.on("user-toggle-video",handleToggleVideo),e.on("user-leave",handleUserLeave),()=>{e.off("user-toggle-audio",handleToggleAudio),e.off("user-toggle-video",handleToggleVideo),e.off("user-leave",handleUserLeave)}},[u,d,e,h]),(0,l.useEffect)(()=>{n&&c&&n.on("call",e=>{let{peer:o}=e;e.answer(c),e.on("stream",n=>{console.log("incoming stream from ".concat(o)),d(e=>({...e,[o]:{url:n,muted:!0,playing:!0}})),f(n=>({...n,[o]:e}))})})},[n,d,c]),(0,l.useEffect)(()=>{c&&i&&(console.log("setting my stream ".concat(i)),d(e=>({...e,[i]:{url:c,muted:!0,playing:!0}})))},[i,d,c]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:A().activePlayerContainer,children:g&&(0,t.jsx)(component_Player,{url:g.url,muted:g.muted,playing:g.playing,isActive:!0})}),(0,t.jsx)("div",{className:A().inActivePlayerContainer,children:Object.keys(m).map(e=>{let{url:o,muted:n,playing:l}=m[e];return(0,t.jsx)(component_Player,{url:o,muted:n,playing:l,isActive:!1},e)})}),(0,t.jsx)(component_Bottom,{muted:null==g?void 0:g.muted,playing:null==g?void 0:g.playing,toggleAudio:_,toggleVideo:y,leaveRoom:v})]})}},7466:function(e){e.exports={bottomMenu:"Bottom_bottomMenu__rX2aM",icon:"Bottom_icon__XRO21",active:"Bottom_active__Lp_5N"}},5560:function(e){e.exports={playerContainer:"Player_playerContainer__BPdoN",active:"Player_active__Equ4e",notActive:"Player_notActive__FdT1W",icon:"Player_icon__OsMei",user:"Player_user__72SDS",notPlaying:"Player_notPlaying__A4t_l"}},3136:function(e){e.exports={activePlayerContainer:"room_activePlayerContainer__emLCX",inActivePlayerContainer:"room_inActivePlayerContainer__IRdKy"}}},function(e){e.O(0,[204,774,888,179],function(){return e(e.s=1040)}),_N_E=e.O()}]);
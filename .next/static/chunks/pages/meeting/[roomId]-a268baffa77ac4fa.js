(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[435],{1040:function(e,o,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/meeting/[roomId]",function(){return t(3830)}])},3830:function(e,o,t){"use strict";t.r(o),t.d(o,{default:function(){return _roomId_}});var n=t(2676),l=t(5271),r=t(2222),i=t.n(r);t(948);let a=(0,l.createContext)(null),useSocket=()=>{let e=(0,l.useContext)(a);return e};var s=t(3087);let{useState:c,useEffect:u,useRef:d}=t(5271);var hooks_usePeer=()=>{let e=useSocket(),o=(0,s.useRouter)().query.roomId,[n,l]=c(null),[r,i]=c(""),a=d(!1);return u(()=>{let n;!a.current&&o&&e&&(a.current=!0,async function(){l(n=new(await t.e(229).then(t.bind(t,5229))).default),n.on("open",t=>{console.log("your peer id is ".concat(t)),i(t),null==e||e.emit("join-room",o,t)})}())},[o,e]),{peer:n,myId:r}},hooks_useMediaStream=()=>{let[e,o]=(0,l.useState)(null),t=(0,l.useRef)(!1);return(0,l.useEffect)(()=>{t.current||(t.current=!0,async function(){try{let e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});console.log("setting your stream"),o(e)}catch(e){console.log("Error in media navigator",e)}}())},[]),{stream:e}},hooks_usePlayer=(e,o,t)=>{let n=useSocket(),[r,a]=(0,l.useState)({}),c=(0,s.useRouter)(),u=i()(r),d=u[e];return delete u[e],{players:r,setPlayers:a,playerHighlighted:d,nonHighlightedPlayers:u,toggleAudio:()=>{console.log("I toggled my audio"),a(o=>{let t=i()(o);return t[e].muted=!t[e].muted,{...t}}),n.emit("user-toggle-audio",e,o)},toggleVideo:()=>{console.log("I toggled my video"),a(o=>{let t=i()(o);return t[e].playing=!t[e].playing,{...t}}),n.emit("user-toggle-video",e,o)},leaveRoom:()=>{n.emit("user-leave",e,o),console.log("leaving room",o),null==t||t.disconnect(),c.push("/")}}},g=t(5110),m=t.n(g),_=t(2187),v=t.n(_),y=t(2189),f=t(1959),h=t(311),p=t(5560),P=t.n(p),component_Player=e=>{let{url:o,muted:t,playing:l,isActive:r}=e;return(0,n.jsxs)("div",{className:v()(P().playerContainer,{[P().notActive]:!r,[P().active]:r,[P().notPlaying]:!l}),children:[l?(0,n.jsx)(m(),{url:o,muted:t,playing:l,width:"100%",height:"100%"}):(0,n.jsx)(y.Z,{className:P().user,size:r?400:150}),r?void 0:t?(0,n.jsx)(f.Z,{className:P().icon,size:20}):(0,n.jsx)(h.Z,{className:P().icon,size:20})]})},x=t(462),C=t(1020),k=t(6440),j=t(7466),N=t.n(j),component_Bottom=e=>{let{muted:o,playing:t,toggleAudio:l,toggleVideo:r,leaveRoom:i}=e;return(0,n.jsxs)("div",{className:N().bottomMenu,children:[o?(0,n.jsx)(f.Z,{className:v()(N().icon,N().active),size:55,onClick:l}):(0,n.jsx)(h.Z,{className:N().icon,size:55,onClick:l}),t?(0,n.jsx)(x.Z,{className:N().icon,size:55,onClick:r}):(0,n.jsx)(C.Z,{className:v()(N().icon,N().active),size:55,onClick:r}),(0,n.jsx)(k.Z,{size:55,className:v()(N().icon),onClick:i})]})},w=t(3136),A=t.n(w),_roomId_=()=>{let e=useSocket(),{roomId:o}=(0,s.useRouter)().query,{peer:t,myId:r}=hooks_usePeer(),{stream:a}=hooks_useMediaStream(),{players:c,setPlayers:u,playerHighlighted:d,nonHighlightedPlayers:g,toggleAudio:m,toggleVideo:_,leaveRoom:v}=hooks_usePlayer(r,o,t),[y,f]=(0,l.useState)([]);return(0,l.useEffect)(()=>{if(!e||!t||!a)return;let handleUserConnected=e=>{console.log("user connected in room with userId ".concat(e));let o=t.call(e,a);o.on("stream",t=>{console.log("incoming stream from ".concat(e)),u(o=>({...o,[e]:{url:t,muted:!0,playing:!0}})),f(t=>({...t,[e]:o}))})};return e.on("user-connected",handleUserConnected),()=>{e.off("user-connected",handleUserConnected)}},[t,u,e,a]),(0,l.useEffect)(()=>{if(!e)return;let handleToggleAudio=e=>{console.log("user with id ".concat(e," toggled audio")),u(o=>{let t=i()(o);return t[e].muted=!t[e].muted,{...t}})},handleToggleVideo=e=>{console.log("user with id ".concat(e," toggled video")),u(o=>{let t=i()(o);return t[e].playing=!t[e].playing,{...t}})},handleUserLeave=e=>{var o;console.log("user ".concat(e," is leaving the room")),null===(o=y[e])||void 0===o||o.close();let t=i()(c);delete t[e],u(t)};return e.on("user-toggle-audio",handleToggleAudio),e.on("user-toggle-video",handleToggleVideo),e.on("user-leave",handleUserLeave),()=>{e.off("user-toggle-audio",handleToggleAudio),e.off("user-toggle-video",handleToggleVideo),e.off("user-leave",handleUserLeave)}},[c,u,e,y]),(0,l.useEffect)(()=>{t&&a&&t.on("call",e=>{let{peer:o}=e;e.answer(a),e.on("stream",t=>{console.log("incoming stream from ".concat(o)),u(e=>({...e,[o]:{url:t,muted:!0,playing:!0}})),f(t=>({...t,[o]:e}))})})},[t,u,a]),(0,l.useEffect)(()=>{a&&r&&(console.log("setting my stream ".concat(r)),u(e=>({...e,[r]:{url:a,muted:!0,playing:!0}})))},[r,u,a]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:A().activePlayerContainer,children:d&&(0,n.jsx)(component_Player,{url:d.url,muted:d.muted,playing:d.playing,isActive:!0})}),(0,n.jsx)("div",{className:A().inActivePlayerContainer,children:Object.keys(g).map(e=>{let{url:o,muted:t,playing:l}=g[e];return(0,n.jsx)(component_Player,{url:o,muted:t,playing:l,isActive:!1},e)})}),(0,n.jsx)(component_Bottom,{muted:null==d?void 0:d.muted,playing:null==d?void 0:d.playing,toggleAudio:m,toggleVideo:_,leaveRoom:v})]})}},7466:function(e){e.exports={bottomMenu:"Bottom_bottomMenu__rX2aM",icon:"Bottom_icon__XRO21",active:"Bottom_active__Lp_5N"}},5560:function(e){e.exports={playerContainer:"Player_playerContainer__BPdoN",active:"Player_active__Equ4e",notActive:"Player_notActive__FdT1W",icon:"Player_icon__OsMei",user:"Player_user__72SDS",notPlaying:"Player_notPlaying__A4t_l"}},3136:function(e){e.exports={activePlayerContainer:"room_activePlayerContainer__emLCX",inActivePlayerContainer:"room_inActivePlayerContainer__IRdKy"}}},function(e){e.O(0,[425,774,888,179],function(){return e(e.s=1040)}),_N_E=e.O()}]);